{% extends "users/base.html" %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<link rel="stylesheet" href="{% static 'css/restaurant_recommandations.css' %}">

<!-- Floating button to open sidebar -->
<button class="sidebar-toggle-btn" id="openSidebarBtn" title="Open filters or results">
    <span>&#9776;</span>
</button>

<!-- Sidebar hidden by default -->
<div class="sidebar-float" id="sidebarFloat">
    <button class="close-btn" id="closeSidebarBtn" title="Close">&times;</button>
    <h2>Filters & Results</h2>
    <div class="sidebar-content">
        <p>Here you can put your filters, results, or any other useful information.</p>
        <ul style="margin-top:1.5rem;opacity:0.8;">
            <li>• Search filters</li>
            <li>• Restaurant list</li>
            <li>• Restaurant details</li>
            <li>• ...</li>
        </ul>
    </div>
    <div class="sidebar-footer">Culturo &copy; 2024</div>
</div>

<div id="map"></div>

<!-- Floating carousel at bottom of page -->
<div class="bottom-carousel" id="bottomCarousel">
    <button class="carousel-hide-btn" id="hideCarouselBtn" title="Hide carousel">&times;</button>
    <div class="carousel-track" id="carouselTrack">
        <!-- Restaurant cards will be injected here by JS -->
    </div>
</div>

<!-- Button to show carousel again -->
<button class="show-carousel-btn" id="showCarouselBtn" title="Show restaurants">
    <i class="fa-solid fa-utensils"></i>
</button>

<!-- Floating Chatbot Icon and Chat Window -->
{% if user.is_authenticated %}
<button id="chatbot-toggle" aria-label="Open Chatbot">
    <i class="fas fa-comments"></i>
</button>
<div id="restaurant-chatbot">
    <div class="chatbot-header">
        <span><i class="fas fa-robot"></i> Culturo Chatbot</span>
        <button id="chatbot-close" aria-label="Close Chatbot">&times;</button>
    </div>
    <div id="chatbot-messages">
        <div class="chat-bubble bot-message">
            Hello! How can I help you find your next restaurant? I can recommend restaurants based on your cuisine, budget, or location preferences worldwide.
        </div>
    </div>
    <!-- Loading indicator -->
    <div id="chatbot-loading" style="display: none; padding: 10px; text-align: center;">
        <div class="loading-dots">
            <span>●</span>
            <span>●</span>
            <span>●</span>
        </div>
        <p style="margin: 5px 0 0 0; font-size: 12px; color: #666;">Searching...</p>
    </div>
    <form id="chatbot-form">
        <input id="chatbot-input" type="text" placeholder="Type your message..." autocomplete="off">
        <button id="chatbot-send" type="submit"><i class="fas fa-paper-plane"></i></button>
    </form>
</div>
{% endif %}

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="{% static 'js/restaurant_recommandations.js' %}"></script>
{% endblock %}